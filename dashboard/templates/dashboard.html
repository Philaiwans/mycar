{% load static %} <!-- โหลด tag static เพื่อใช้รูป placeholder -->

<!DOCTYPE html>
<html lang="th" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ===== ธีมสีน้ำเงินเข้ม + ปรับตัวแปรของ Bootstrap ===== */
    :root {
      --bg-navy: #0B1F3A;
      --blue-800: #14345C;
      --blue-700: #234B72;
      --blue-500: #55A8E8;
      --blue-300: #9FD8EF;
      --muted: #9fb0c6;

      /* override bootstrap colors */
      --bs-body-bg: var(--bg-navy);
      --bs-body-color: #e6eef9;
      --bs-primary: var(--blue-700);
      --bs-border-color: #183453;
      --bs-card-bg: #0F2747;
      --bs-card-border-color: #183453;
      --bs-table-bg: transparent;
      --bs-table-color: #e6eef9;
      --bs-table-striped-bg: rgba(255, 255, 255, .03);
      --bs-table-hover-bg: rgba(85, 168, 232, .08);

      --thumb-w: 120px;
    }

    body {
      background: linear-gradient(180deg, var(--bg-navy), #0a1a2f 40%);
    }

    /* กล่องการ์ด */
    .card {
      background: var(--bs-card-bg);
      border: 1px solid var(--bs-card-border-color);
      box-shadow: 0 6px 20px rgba(0, 0, 0, .25), inset 0 1px 0 rgba(159, 216, 239, .04);
      border-radius: 16px;
    }

    /* ปุ่มหลัก */
    .btn-primary {
      background: linear-gradient(135deg, var(--blue-700), var(--blue-500));
      border: 1px solid var(--blue-500);
    }

    .btn-outline-light {
      border-color: var(--blue-500);
      color: var(--blue-300);
    }

    .btn-outline-light:hover {
      background: var(--blue-500);
      color: #061425;
    }

    /* ส่วนหัวตาราง */
    .table thead {
      background: linear-gradient(180deg, var(--blue-800), var(--blue-700));
      color: #eaf6ff;
    }

    .table td,
    .table th {
      border-color: var(--bs-border-color);
    }

    /* สีตัวหนังสือจาง */
    .muted {
      color: var(--muted) !important;
    }

    /* กล่องค้นหา */
    .form-control {
      background: #0c203d;
      border: 1px solid var(--bs-border-color);
      color: #eaf2ff;
    }

    .form-control:focus {
      border-color: var(--blue-500);
      box-shadow: 0 0 0 .25rem rgba(85, 168, 232, .25);
    }

    /* ระยะขอบหน้า */
    .wrap {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px;
    }

    /* รูปย่อในตาราง (thumbnail) */
    .thumb {
      width: var(--thumb-w);
      height: calc(var(--thumb-w) * 2 / 3);
      /* อัตราส่วน 3:2 */
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid var(--bs-border-color);
    }
  </style>
</head>

<body>

  <div class="wrap">
    <!-- ===== Header (หัวเรื่อง + ปุ่มกลับ + คำอธิบาย + ช่องค้นหา) ===== -->
    <div class="mb-3">
      <!-- หัวเรื่อง + ปุ่มกลับ -->
      <div class="d-flex align-items-center justify-content-between mb-1">
        <h1 class="h4 mb-0">ตารางข้อมูลป้ายทะเบียนรถ</h1>
        <a href="{% url 'home' %}" class="btn btn-secondary btn-sm">กลับหน้าแรก</a>
      </div>

      <!-- คำอธิบายใต้หัวเรื่อง -->
      <div class="muted small mb-2">ค้นหาเลขทะเบียนได้ที่ช่องค้นหา</div>

      <!-- ช่องค้นหา (ย้ายลงมาด้านล่างคำอธิบาย) -->
      <div class="input-group input-group-sm mb-3" style="max-width:520px;">
        <input id="plateSearch" type="text" class="form-control form-control-sm" placeholder="ค้นหา เลขทะเบียน/จังหวัด">
        <button class="btn btn-outline-light" onclick="clearPlateSearch()">ล้าง</button>
      </div>
    </div>

    <!-- ===== ตารางป้ายทะเบียนรถ ===== -->
    <div class="card p-3">
      <div class="table-responsive">
        <table class="table table-sm table-hover align-middle mb-0" id="plateTable">
          <thead>
            <tr>
              <th style="width:64px;">ลำดับ</th>
              <th style="width: var(--thumb-w);">รูปรถ</th> <!-- ปรับตามขนาดรูป --> <!-- คอลัมน์ใหม่: รูปรถ -->
              <th>เลขทะเบียน</th>
              <th>จังหวัด</th>
              <th>เวลาเข้า</th>
              <th>เวลาออก</th>
            </tr>
          </thead>
          <tbody>
            {% for row in plates %}
            <tr>
              <!-- ลำดับแถว -->
              <td>{{ forloop.counter }}</td>

              <!-- คอลัมน์รูป: ถ้ามีไฟล์ให้แสดง, ถ้าไม่มีก็ใช้ placeholder จาก static -->
              <td>
                <a data-bs-toggle="modal" data-bs-target="#imgModal{{ row.id }}">
                  {% if row.car_image %}
                  <img src="{{ row.car_image.url }}" alt="car" class="thumb">
                  {% else %}
                  <img src="{% static 'img/no-car.png' %}" alt="no car" class="thumb">
                  {% endif %}
                </a>

                <!-- Modal แสดงรูปใหญ่ -->
                <div class="modal fade" id="imgModal{{ row.id }}" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content bg-dark">
                      <div class="modal-body p-0">
                        <img
                          src="{% if row.car_image %}{{ row.car_image.url }}{% else %}{% static 'img/no-car.png' %}{% endif %}"
                          class="img-fluid w-100" alt="car">
                      </div>
                    </div>
                  </div>
                </div>
              </td>

              <!-- ข้อมูลทะเบียน/จังหวัด -->
              <td class="fw-semibold">{{ row.plate }}</td>
              <td>{{ row.province }}</td>

              <!-- เวลาเข้า/ออก (จัดรูปแบบ dd/mm/yyyy hh:mm) -->
              <td>{{ row.check_in|date:"d/m/Y H:i" }}</td>
              <td>
                {% if row.check_out %}
                {{ row.check_out|date:"d/m/Y H:i" }}
                {% else %}
                —
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <!-- กรณีไม่มีข้อมูล -->
            <tr>
              <td colspan="6" class="text-center muted">ไม่มีข้อมูล</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== สคริปต์ค้นหาแบบ client-side: กรองจากเลขทะเบียน/จังหวัด ===== -->
  <script>
    const search = document.getElementById('plateSearch');
    const table = document.getElementById('plateTable').getElementsByTagName('tbody')[0];

    function filterTable() {
      const q = (search.value || '').toLowerCase().trim();
      const rows = table.getElementsByTagName('tr');
      for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('td');
        if (!cells.length) continue;
        const plate = (cells[2].innerText || '').toLowerCase();   // คอลัมน์เลขทะเบียน
        const province = (cells[3].innerText || '').toLowerCase(); // คอลัมน์จังหวัด
        rows[i].style.display = (plate.includes(q) || province.includes(q)) ? '' : 'none';
      }
    }
    function clearPlateSearch() { search.value = ''; filterTable(); }
    search.addEventListener('input', filterTable);
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>